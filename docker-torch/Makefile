IMAGE_NAME ?= lsirepfl/pytorch

PYTHON_VERSION ?= 3.7.10
CUDA_VERSION ?= 11.0
TORCH_VERSION ?= 1.7.1
TORCHVISION_VERSION ?= 0.8.2
IMAGE_TAG_PREFIX ?=
DOCKERFILE ?= Dockerfile.from-binary

CUDA_MAGMA_VERSION := $(subst .,,${CUDA_VERSION})
IMAGE_TAG := ${IMAGE_TAG_PREFIX}v1.7.1-py${PYTHON_VERSION}-cu${CUDA_MAGMA_VERSION}

build:
	@docker build . -f ${DOCKERFILE} \
		--build-arg PYTHON_VERSION=${PYTHON_VERSION} \
		--build-arg CUDA_VERSION=${CUDA_VERSION} \
		--build-arg CUDA_MAGMA_VERSION=${CUDA_MAGMA_VERSION} \
		--build-arg TORCH_VERSION=${TORCH_VERSION} \
		--build-arg TORCHVISION_VERSION=${TORCHVISION_VERSION} \
		-t ${IMAGE_NAME}:${IMAGE_TAG}
